<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">
<f:view>
	<h:head>

		<title>#{Gestionpagos.titulo}</title>
	</h:head>
	<body
		style="background-color: #edf6f9; font-family: verdana, arial; margin: 0px; margin-top: 0px; font-weight: bold;">
		<h:form id="documento" style="background-color: #edf6f9; width: 100%;">
			<div
				style="width: 100%; background-color: #a3cef1; height: 30px; display: flex; align-items: center; justify-content: space-between;">
				<h:outputText style="float: left; margin-left: 20px;"
					value="¡Bienvenido, #{usuario.coUsuarios} !"
					rendered="#{not empty usuario}" />
				<div style="display: flex; align-items: center;">
					<h:commandLink id="administrarUsuarios"
						rendered="#{Gestionusuarios.objetoSeleccionado.boAdmin eq 1}"
						style="color: #000; float: right; margin-right: 20px; font-size: 12px; text-decoration: none; padding: 3px;"
						onmouseover="this.style.color='#000'; this.style.backgroundColor='#6096ba'; this.style.transform='scale(1.05)'; this.style.borderRadius='15px';"
						onmouseout="this.style.color='#000';  this.style.transform='scale(1)'; this.style.backgroundColor='transparent'; this.style.borderRadius='none';"
						value="Administrar usuarios"
						action="#{Gestionusuarios.administrar()}" />
					<h:commandLink style="float: right; margin-right: 20px;"
						action="#{Gestionusuarios.perfil()}" update="documento">
						<img src="usuario.png" alt="Perfil de usuario"
							style="width: 25px; height: 25px; transition: background-color 0.3s; border-radius: 50%; padding: 2px;"
							onmouseover="this.style.backgroundColor='#6096ba';"
							onmouseout="this.style.backgroundColor='transparent';"> </img>
					</h:commandLink>
					<h:commandLink style="float: right; margin-right: 20px;"
						action="#{Gestionusuarios.cerrarSesion()}" update="documento">
						<img src="salir.png" alt="Cerrar Sesión"
							style="width: 25px; height: 25px; transition: background-color 0.3s; border-radius: 50%; margin: 5px;"
							onmouseover="this.style.backgroundColor='#6096ba';"
							onmouseout="this.style.backgroundColor='transparent';"> </img>
					</h:commandLink>
				</div>
			</div>
			<div
				style="background-color: #003049; color: #FFFFFF; text-align: center; padding: 10px;">
				<h1>Alta de Pagos</h1>
			</div>
			<br></br>
			<div style="display: flex; justify-content: center; margin: 10px;">
				<p:commandButton
					style="width: 200px; height: 30px; border-radius: 15px; margin-left: 10px; margin-right: 10px; 
				    background-color: #e5e5e5; border: none; color: black; font-size: 16px; font-weight: bold; text-transform: uppercase;
				    display: flex; justify-content: center; align-items: center; box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.3);"
					onmouseover="this.style.backgroundColor='#e0e1dd'; this.style.color='#ffff'; this.style.transform='scale(1.05)'; this.style.fontSize='17px';"
					onmouseout="this.style.backgroundColor='#e5e5e5'; this.style.color='black'; this.style.transform='scale(1)'; this.style.fontSize='16px';"
					value="Volver" action="#{Gestionpagos.volver()}">
				</p:commandButton>

				<p:commandButton
					style="width: 200px; height: 30px; border-radius: 15px; 
				    background-color: #ffc300; border: none; color: black; font-size: 16px; font-weight: bold; text-transform: uppercase;
				    display: flex; justify-content: center; align-items: center; margin-right: 10px; box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.3);"
					onmouseover="this.style.backgroundColor='#ffd60a'; this.style.color='#ffff'; this.style.transform='scale(1.05)'; this.style.fontSize='17px';"
					onmouseout="this.style.backgroundColor='#ffc300'; this.style.color='black'; this.style.transform='scale(1)'; this.style.fontSize='16px';"
					value="Limpiar" action="#{Gestionpagos.limpiarAlta()}"
					update="documento">
				</p:commandButton>

				<p:commandButton
					style="width: 200px; height: 30px; border-radius: 15px;  
					background-color: #a3cef1; border: none; color: black; font-size: 16px; font-weight: bold; margin-right: 10px; text-transform: uppercase;
					display: flex; justify-content: center; align-items: center; box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.3);"
					onmouseover="this.style.backgroundColor='#6096ba'; this.style.color='#ffff'; this.style.transform='scale(1.05)'; this.style.fontSize='17px';"
					onmouseout="this.style.backgroundColor='#a3cef1'; this.style.color='#000'; this.style.transform='scale(1)'; this.style.fontSize='16px';"
					value="Grabar" action="#{Gestionpagos.grabar()}" update="documento">
				</p:commandButton>
			</div>
			<h4 style="text-align: center;">Datos del pago</h4>
			<table style="border-spacing: 0px; width: 100%;">
				<tr style="background-color: #F0EAAF; padding: 5px;">
					<td style="text-align: center; padding: 5px"><label
						for="codigoPago" style="display: inline-block; width: 200px;">
							Código: </label> <p:inputText
							style="width: 400px; padding: 5px; border: 1px solid #AFE3F0; border-radius: 5px;"
							id="codigoPago"
							value="#{Gestionpagos.objetoSeleccionado.coPagos}"
							disabled="#{not empty Gestionpagos.objetoSeleccionado.coPagos}">
						</p:inputText></td>
				</tr>
				<tr style="background-color: #FFF6E9; padding: 5px;">
					<td style="text-align: center; padding: 5px"><label
						for="descripcionPago" style="display: inline-block; width: 200px;">
							Descripción: </label> <p:inputText
							style="width: 400px; padding: 5px; border: 1px solid #AFE3F0; border-radius: 5px;"
							id="descripcionPago"
							value="#{Gestionpagos.objetoSeleccionado.dsPagos}">
						</p:inputText></td>
				</tr>
				<tr style="background-color: #F0EAAF;">
					<td style="text-align: center; padding: 5px"><label
						for="fechaPago" style="display: inline-block; width: 200px;">
							Fecha: </label> <p:inputText
							style="width: 400px; padding: 5px; border: 1px solid #AFE3F0; border-radius: 5px;"
							id="fechaPago"
							value="#{Gestionpagos.objetoSeleccionado.fePagosStr}"
							placeholder="Ej: 01/02/2024">
						</p:inputText></td>
				</tr>
				<tr style="background-color: #FFF6E9; padding: 5px;">
					<td style="text-align: center; padding: 5px"><label
						for="descripcionTercero"
						style="display: inline-block; width: 200px;"> Tercero: </label> <p:inputText
							style="width: 400px; padding: 5px; border: 1px solid #AFE3F0; border-radius: 5px;"
							id="descripcionTercero"
							value="#{Gestionpagos.objetoSeleccionado.dsTercero}">
						</p:inputText></td>
				</tr>
				<tr style="background-color: #F0EAAF; padding: 5px;">
					<td style="text-align: center; padding: 5px"><label
						for="descripcionCuenta"
						style="display: inline-block; width: 200px;"> Cuenta: </label> <p:inputText
							style="width: 400px; padding: 5px; border: 1px solid #AFE3F0; border-radius: 5px;"
							id="descripcionCuenta"
							value="#{Gestionpagos.objetoSeleccionado.dsCuenta}"
							placeholder="Ej: ESXX XXXX XXXX XXXX XXXX XXXX">
						</p:inputText></td>
				</tr>
				<tr style="background-color: #FFF6E9; padding: 5px;">
					<td style="text-align: center; padding: 5px"><label
						for="importePago" style="display: inline-block; width: 200px;">
							Importe: </label> <p:inputText
							style="width: 400px; padding: 5px; border: 1px solid #AFE3F0; border-radius: 5px;"
							id="importePago"
							value="#{Gestionpagos.objetoSeleccionado.imPagos}"
							readonly="true">
							<p:ajax update="importePago" />
						</p:inputText></td>
				</tr>
				<tr style="background-color: #F0EAAF; padding: 5px;">
					<td style="text-align: center; padding: 5px"><label
						for="usuarioPago" style="display: inline-block; width: 200px;">
							Usuario: </label> <p:inputText
							style="width: 400px; padding: 5px; border: 1px solid #AFE3F0; border-radius: 5px;"
							id="usuarioPago"
							value="#{Gestionpagos.objetoSeleccionado.usuarioBd}">
						</p:inputText></td>
				</tr>
			</table>
			<p:dialog header="Error" widgetVar="errorDialog" modal="true"
				resizable="false">
				<p:outputLabel id="mensajeError" />
			</p:dialog>
			<br></br>
			<div
				style="width: 100%; display: flex; align-items: center; justify-content: space-evenly;">
				<h2 style="margin-right: 10px">Facturas asociadas a este pago</h2>

				<!-- Pop up -->
				<p:commandButton value="Agregar facturas"
					update="@widgetVar(popup) tablaFacturas"
					oncomplete="PF('popup').show()"
					action="#{Gestionpagos.obtenerFacturasPopup()}"
					style="border-radius: 20px; font-size: 16px; background-color: #4cc9f0;
		        				 border: none; color: black; font-weight: bold; box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.3);"
					onmouseover="this.style.backgroundColor='#118ab2'; this.style.color='#FFF';"
					onmouseout="this.style.backgroundColor='#4cc9f0'; this.style.color='black';" />
			</div>
			<p:dialog header="Agregar facturas a este pago" widgetVar="popup"
				modal="true" resizable="false" style="text-align: center; ">
				<!-- Lista facturas no asociadas -->
				<p:dataTable id="tablaFacturas"
					value="#{Gestionpagos.listaFacturas}" var="item"
					rowKey="#{item.id}"
					style="border-collapse: collapse; width: 100%; max-height: 500px; overflow-y: auto; background-color: #FFF6E9;"
					emptyMessage="No se encontraron facturas..">
					<p:column headerText="Agregar" style=" text-align: center;">
						<p:selectBooleanCheckbox value="#{item.seleccionada}" />
					</p:column>
					<p:column headerText="Código Factura" style=" text-align: center;">
						<h:outputText value="#{item.coFacturas}" />
					</p:column>

					<p:column headerText="Descripción Factura"
						style="text-align: center;">
						<h:outputText value="#{item.dsFacturas}" />
					</p:column>

					<p:column headerText="Fecha Factura" style="text-align: center;">
						<h:outputText value="#{item.feFacturasStr}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column headerText="Importe Factura" style="text-align: center;">
						<h:outputText value="#{item.imFacturas}" />
					</p:column>

					<p:column headerText="Impuesto Factura" style="text-align: center;">
						<h:outputText value="#{item.coImpuesto}" />
					</p:column>

					<p:column headerText="Total Factura" style="text-align: center;">
						<h:outputText value="#{item.imBaseImponible}" />
					</p:column>
				</p:dataTable>
				<p:commandButton
					style="margin-top: 30px; box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.3);"
					value="Añadir facturas"
					action="#{Gestionpagos.agregarFacturasSeleccionadas}"
					update="documento" />
			</p:dialog>

			<br></br>

			<!-- Lista facturas asociadas -->
			<div
				style="display: flex; justify-content: center; margin-bottom: 50px;">
				<p:dataTable id="tablaFacturasAsociadas"
					value="#{Gestionpagos.listaFacturasSeleccionadas}" var="item"
					rowKey="#{item.id}"
					style="border-collapse: collapse; width: 90%; max-height: 500px;
				             overflow-y: auto; background-color: #FFF6E9;
				             border: 5px solid #F0EAAF; border-radius: 15px; 
				             box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.3);"
					emptyMessage="Todavía no has agregado facturas a este pago..">

					<p:column headerText="Código Factura" style=" text-align: center;">
						<h:outputText value="#{item.coFacturas}" />
					</p:column>

					<p:column headerText="Descripción Factura"
						style="text-align: center;">
						<h:outputText value="#{item.dsFacturas}" />
					</p:column>

					<p:column headerText="Fecha Factura" style="text-align: center;">
						<h:outputText value="#{item.feFacturasStr}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p:column>

					<p:column headerText="Importe Factura" style="text-align: center;">
						<h:outputText value="#{item.imFacturas}" />
					</p:column>

					<p:column headerText="Impuesto Factura" style="text-align: center;">
						<h:outputText value="#{item.coImpuesto}" />
					</p:column>

					<p:column headerText="Total Factura" style="text-align: center;">
						<h:outputText value="#{item.imBaseImponible}" />
					</p:column>

					<p:column headerText="Quitar" style="text-align: center;">
						<p:commandButton
							style="background-color: red; border-radius: 50%;
				         border: none; box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.3); color: black;"
							onmouseover="this.style.backgroundColor='#FF7F7F'; this.style.color='#FFF';"
							onmouseout="this.style.backgroundColor='red'; this.style.color='black';"
							icon="pi pi-times" action="#{Gestionpagos.quitarFactura(item)}"
							update="documento:tablaFacturasAsociadas, documento:importePago" />
					</p:column>
				</p:dataTable>
			</div>
			<h:messages style="color: red;" id="messages" showSummary="true"
				showDetail="true" />
		</h:form>
		<script>
			function confimacionBorrado() {
				if (confirm('¿Estás seguro de que deseas eliminar la factura?')) {
					mostrarMensajeExito();
					eliminarFactura();
					return true;
				} else {
					return false;
				}
			}

			function mostrarMensajeExito() {
				alert('¡La factura ha sido eliminada exitosamente!');
			}
		</script>

	</body>
</f:view>
</html>